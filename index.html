<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CekZakat</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .btn-custom-1 {
            background-color: #ffffff;
            color: #000000;
            /* Text color */
            border: none;
            border-radius: 10px;
            /* Adjust the border-radius to make the button more or less rounded */
            padding: 10px 10px;
            box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.1);
            /* Add margin between each button */
        }

        .btn-custom-1-selected {
            background-color: wheat;
            color: #000000;
            /* Text color */
            border: none;
            border-radius: 10px;
            /* Adjust the border-radius to make the button more or less rounded */
            padding: 10px 10px;
            box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.1);
            /* Add margin between each button */
        }

        .btn-custom-1:hover {
            background-color: wheat
                /* Shadow on hover */
        }

        .btn-custom-2 {
            background-color: #000000;
            color: #ffffff;
            /* Text color */
            border: none;
            border-radius: 30px;
            /* Adjust the border-radius to make the button more or less rounded */
            padding: 10px 10px;
            box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.1);
            /* Add margin between each button */
        }

        .btn-custom-2:hover {
            background-color: wheat
                /* Shadow on hover */
        }

        .form-control.rounded-muted {
            border-radius: 1.25rem;
            background-color: #f0f0f0;
            border-color: #f0f0f0;
            height: 50px;
        }

        .footer-custom {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: wheat;
            color: black;
            text-align: center;
            padding: 10px 0;
        }
    </style>
</head>

<body>

    <div class="container-main">
        <nav class="navbar navbar-light navbar-expand-lg bg-white shadow">
            <div class="container">
                <a class="navbar-brand fw-bolder" href="#">CekZakat</a>
                <button class="navbar-toggler text-white" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link text-dark fw-bold" href="#">about</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark fw-lighter" onclick="logout()">logout</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container mt-5 mb-5 container-scrollable">
            <div class="row justify-content-center">
                <div class="col-md-6 mb-5">
                    <div class="card border-0 rounded-5 shadow-lg p-3">
                        <div class="card-body">
                            <div class="col-md-12">
                                <div class="row mb-5 text-center">
                                    <h5 class="fw-bolder">Pilih Jenis Zakat Anda</h5>
                                </div>
                                <div class="row justify-content-center mb-5 text-center">
                                    <div class="col m-1 btn-custom-1 btn-zakat-type">
                                        <button class="btn btn-white fw-semibold" onclick="getZakatType(this)">Penghasilan</button>
                                    </div>
                                    <div class="col m-1 btn-custom-1 btn-zakat-type">
                                        <button class="btn btn-white fw-semibold" onclick="getZakatType(this)">Tabungan</button>
                                    </div>
                                    <div class="col m-1 btn-custom-1 btn-zakat-type">
                                        <button class="btn btn-white fw-semibold" onclick="getZakatType(this)">Emas</button>
                                    </div>
                                    <div class="col m-1 btn-custom-1 btn-zakat-type">
                                        <button class="btn btn-white fw-semibold" onclick="getZakatType(this)">Perak</button>
                                    </div>
                                </div>
                                <div class="row form-body">
                                    <div class="mb-3">
                                        <label for="username" class="form-label">Masukkan jumlah zakat <span class="tipezakat"></span> anda</label>
                                        <input type="number" class="form-control rounded-muted" id="jumlahzakat"
                                            placeholder="Masukkan Jumlah Harta Anda">
                                    </div>
                                </div>
                                <div class="row mb-3 p-5">
                                    <div class="card">
                                        <div class="card-header bg-white">
                                            Notes
                                        </div>
                                        <div class="card-body">
                                            Perhitungan zakat berdasarkan harga emas saat ini.
                                            Harga emas saat ini adalah :
                                            <p class="fw-semibold gold-price">loading...</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="row px-5">
                                    <button class="btn btn-custom-2" onclick="hitungZakat()"> Cek Zakat Anda</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-custom fw-semibold">
            <p>&copy; 2024 cekzakat. All rights reserved. Made with ðŸ“¿, ðŸ•Œ, ðŸ’», ðŸ«¶ and â˜• by <a
                    href="https://github.com/fianrmdni" target="_blank" class="text-dark">fianramadhani</a> and <a
                    href="https://daffashafwan.github.io" target="_blank" class="text-dark">daffashafwan</a></p>
        </div>
    </div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const username = getCookie('Username')
        var zakatType;
        $(document).ready(function () {
            if (!username) {
                let timerInterval;
                Swal.fire({
                    title: "Belum Login",
                    html: "Membawamu ke halaman login",
                    timer: 1000,
                    timerProgressBar: true,
                    didOpen: () => {
                        Swal.showLoading();
                        const timer = Swal.getPopup().querySelector("b");
                        timerInterval = setInterval(() => {
                            timer.textContent = `${Swal.getTimerLeft()}`;
                        }, 100);
                    },
                    willClose: () => {
                        clearInterval(timerInterval);
                    }
                }).then((result) => {
                    /* Read more about handling dismissals below */
                    if (result.dismiss === Swal.DismissReason.timer) {
                        console.log("I was closed by the timer");
                    }
                    window.location.href = 'auth';
                });
            } else {
                $.ajax({
                    url: "https://logam-mulia-api.vercel.app/prices/hargaemas-com",
                    type: 'GET',
                    success: function (data) {
                        $(".gold-price").text(data.data[0].buy + " Rupiah")
                    },
                    error: function (error) {
                        console.log(error)
                    }
                });
            }
        });

        function getZakatType(button){
            var clickedTextValue = $(button).text();
            if (clickedTextValue.includes("Penghasilan")) {
               zakatType = "penghasilan"
            }

            if (clickedTextValue.includes("Tabungan")) {
               zakatType = "tabungan"
            }

            if (clickedTextValue.includes("Emas")) {
               zakatType = "emas"
            }

            if (clickedTextValue.includes("Perak")) {
               zakatType = "perak"
            }

            $('.tipezakat').text(zakatType)
        }

        function hitungZakat() {
            var jumlahZakat = $('#jumlahzakat').val()
            console.log(jumlahZakat)
            console.log(username)
            $.ajax({
                url: `https://dffshfwn.online/cekzakat/hitung-zakat`,
                type: 'POST',
                contentType: 'application/json',
                dataType: 'json',
                data: JSON.stringify(
                    {
                        Username: username,
                        ZakatType: zakatType,
                        JumlahZakat: parseFloat(jumlahZakat),
                    }),
                success: function (data) {
                    Swal.fire({
                        title: 'Berhasil Mendapatkan Perhitungan Zakat',
                        text: data.Message + " " + data.JumlahZakat,
                        icon: 'success'
                    })
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    Swal.fire({
                        title: 'Gagal menghitung zakat!',
                        text: jqXHR.responseJSON.Message,
                        icon: 'error'
                    })
                    console.error('Ajax error:', textStatus, errorThrown);
                }
            });
        }

        function logout() {
            removeCookie('Username')
            let timerInterval;
            Swal.fire({
                title: "Logout Berhasil",
                html: "Membawamu ke halaman login",
                timer: 1500,
                timerProgressBar: true,
                didOpen: () => {
                    Swal.showLoading();
                    const timer = Swal.getPopup().querySelector("b");
                    timerInterval = setInterval(() => {
                        timer.textContent = `${Swal.getTimerLeft()}`;
                    }, 100);
                },
                willClose: () => {
                    clearInterval(timerInterval);
                }
            }).then((result) => {
                /* Read more about handling dismissals below */
                if (result.dismiss === Swal.DismissReason.timer) {
                    console.log("I was closed by the timer");
                }
                window.location.href = 'auth';
            });
        }

        function getCookie(name) {
            const cookieString = document.cookie;
            const cookies = cookieString.split('; ');

            for (const cookie of cookies) {
                const [cookieName, cookieValue] = cookie.split('=');
                if (cookieName === name) {
                    return cookieValue;
                }
            }

            return null;
        }

        function removeCookie(name) {
            document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`;
        }
    </script>
</body>

</html>